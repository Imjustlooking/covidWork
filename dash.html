<html>
  <head>
    <title>COVID Dashboard</title>
    <link rel = "stylesheet" href = "https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src = "https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src = "https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
    <link rel = "stylesheet" href = "https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <script src = "https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  </head>

  <body>
    <nav>
      <div class = "nav-wrapper black">
        <a href = "#" class = "brand-logo">&nbsp;&nbsp;COVID</a>
        <ul id = "nav-mobile" class = "right hide-on-med-and-down">
          <li><a href = "sass.html">Sass</a></li>
          <li><a href = "badges.html">Components</a></li>
          <li><a href = "collapsible.html">JavaScript</a></li>
        </ul>
      </div>
    </nav>

    <div class="row">
      <div class="col s12 m6">
        <div class="card">
          <div class="card-image">
            <img src="0.jpg">
          </div>
          <div class="card-content">
            <span class="card-title">TOP10 COVID Countries</span>
            <div id = "list"></div>
          </div>
        </div>
      </div>

      <div class="col s12 m6">
        <div class="card">
          <div class="card-content">
            <span class="card-title">TOP10 COVID Countries Map</span>
            <div id = "map" style = "width: 100%; height: 65%"></div>
          </div>
        </div>
      </div>

    </div>
  </body>

  <script>
    axios.get("https://www.trackcorona.live/api/countries").then(response => {
      //console.log(response);
      response.data.data.sort(function(a, b) {
        return b.confirmed - a.confirmed;
      })
      //console.log(response.data.data);
      pushData(response);
      pushMap(response);
    })

    function pushMap(response) {
      var map = L.map('map').setView([39.90, 116.41], 5);

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

      /*L.marker([39.90, 116.41]).addTo(map)
          .bindPopup('A pretty CSS3 popup.<br> Easily customizable.')
          .openPopup();*/

      var myData = response.data.data;
      for (var i = 0; i < myData.length; i++) {
        myRadius = myData[i].confirmed / 20;
        L.circle([myData[i].latitude, myData[i].longitude], {color: "red", radius: myRadius}).addTo(map)
          .bindPopup(myData[i].location + ":<br>" + myData[i].confirmed)
          .openPopup();
      }
    }

    function pushData(response) {
      var divHandle = document.getElementById('list');
      var myHTML = "<ul class = 'collection'>";
      for (var i = 0; i < 10; i++)
        myHTML += "<li class = 'collection-item'>" + (i + 1) + ". " + response.data.data[i].location + "</li>";
      myHTML += "</ul>";
      divHandle.innerHTML = myHTML;
    }
  </script>

</html>
